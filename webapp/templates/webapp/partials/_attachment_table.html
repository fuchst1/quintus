<div class="table-responsive">
    <table class="table table-sm align-middle mb-0">
        <thead class="table-light">
            <tr>
                <th style="width: 88px;">Vorschau</th>
                <th>Dateiname</th>
                <th>Beschreibung</th>
                <th>Kategorie</th>
                <th>Datum</th>
                <th class="text-end">Aktionen</th>
            </tr>
        </thead>
        <tbody>
            {% for row in attachments_panel.rows %}
            <tr>
                <td>
                    {% if row.can_download %}
                        {% if row.is_image %}
                            <a href="{% url 'datei_preview' row.datei.pk %}" target="_blank" rel="noopener" title="Vorschau öffnen">
                                <img
                                    src="{% url 'datei_preview' row.datei.pk %}"
                                    alt="{{ row.datei.original_name }}"
                                    class="rounded border"
                                    style="width: 64px; height: 64px; object-fit: cover;"
                                >
                            </a>
                        {% else %}
                            <a
                                href="{% url 'datei_download' row.datei.pk %}"
                                class="text-secondary"
                                title="Datei herunterladen"
                                download="{{ row.datei.original_name|default:'datei' }}"
                            >
                                <i class="bi bi-file-earmark-text fs-5"></i>
                            </a>
                        {% endif %}
                    {% else %}
                        <div class="text-secondary"><i class="bi bi-file-earmark-text fs-5"></i></div>
                    {% endif %}
                </td>
                <td class="fw-semibold">
                    {% if row.can_download %}
                        <a
                            href="{% if row.is_image %}{% url 'datei_preview' row.datei.pk %}{% else %}{% url 'datei_download' row.datei.pk %}{% endif %}"
                            class="text-decoration-none"
                            {% if not row.is_image %}download="{{ row.datei.original_name|default:'datei' }}"{% endif %}
                            {% if row.is_image %}target="_blank" rel="noopener"{% endif %}
                        >
                            {{ row.datei.original_name|default:row.datei.file.name }}
                        </a>
                    {% else %}
                        {{ row.datei.original_name|default:row.datei.file.name }}
                    {% endif %}
                </td>
                <td>
                    {% if row.datei.beschreibung %}
                        {{ row.datei.beschreibung|linebreaksbr }}
                    {% else %}
                        <span class="text-muted">Keine Beschreibung hinterlegt.</span>
                    {% endif %}
                </td>
                <td>{{ row.datei.get_kategorie_display }}</td>
                <td>{{ row.datei.created_at|date:"d.m.Y H:i" }}</td>
                <td class="text-end">
                    <div class="d-inline-flex gap-1">
                        {% if row.can_download %}
                            <a
                                href="{% if row.is_image %}{% url 'datei_preview' row.datei.pk %}{% else %}{% url 'datei_download' row.datei.pk %}{% endif %}"
                                class="btn btn-sm btn-outline-primary"
                                {% if not row.is_image %}download="{{ row.datei.original_name|default:'datei' }}"{% endif %}
                                {% if row.is_image %}target="_blank" rel="noopener"{% endif %}
                            >
                                Öffnen
                            </a>
                            <a
                                href="{% url 'datei_download' row.datei.pk %}"
                                class="btn btn-sm btn-outline-secondary"
                                download="{{ row.datei.original_name|default:'datei' }}"
                            >
                                Download
                            </a>
                        {% else %}
                            <span class="small text-muted">Nicht verfügbar</span>
                        {% endif %}
                        {% if row.can_archive %}
                            <form
                                method="post"
                                action="{% url 'datei_archive' row.datei.pk %}"
                                onsubmit="return confirm('Datei wirklich archivieren?');"
                                class="d-inline"
                            >
                                {% csrf_token %}
                                <input type="hidden" name="next" value="{{ attachments_panel.next_url }}">
                                <button type="submit" class="btn btn-sm btn-outline-danger">Archivieren</button>
                            </form>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center py-4 text-muted">
                    Keine Dateien für den gewählten Filter vorhanden.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
