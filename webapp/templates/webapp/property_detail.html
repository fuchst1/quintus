{% extends "webapp/base.html" %}
{% block page_title %}Liegenschaft{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold">Liegenschaft – Details</h3>
    <div class="d-flex gap-2">
        <a href="{% url 'property_list' %}" class="btn btn-light">Zurück</a>
        <a href="{% url 'property_update' property_obj.pk %}" class="btn btn-primary">Bearbeiten</a>
    </div>
</div>

<div class="row g-4">
    <div class="col-12 col-xl-8">
        <div class="card border-0 shadow-sm">
            <div class="card-body p-4">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="text-muted small">Name</div>
                        <div class="fw-semibold">{{ property_obj.name }}</div>
                    </div>
                    <div class="col-md-6">
                        <div class="text-muted small">Verwalter</div>
                        <div class="fw-semibold">{{ property_obj.manager|default:"—" }}</div>
                    </div>
                    <div class="col-md-6">
                        <div class="text-muted small">Adresse</div>
                        <div class="fw-semibold">{{ property_obj.street_address }}</div>
                    </div>
                    <div class="col-md-6">
                        <div class="text-muted small">PLZ / Ort</div>
                        <div class="fw-semibold">{{ property_obj.zip_code }} {{ property_obj.city }}</div>
                    </div>
                    <div class="col-md-6">
                        <div class="text-muted small">Heizkostenanteil</div>
                        <div class="fw-semibold">{{ property_obj.heating_share_percent|floatformat:2 }} %</div>
                    </div>
                    <div class="col-md-6">
                        <div class="text-muted small">Einheiten</div>
                        <div class="fw-semibold">
                            {{ unit_count }} gesamt, {{ rented_unit_count }} vermietet, {{ vacant_unit_count }} frei
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="text-muted small">Notizen</div>
                        <div class="fw-semibold">{{ property_obj.notes|default:"—"|linebreaksbr }}</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card border-0 shadow-sm mt-4">
            <div class="card-body p-4">
                <h5 class="mb-3">Eigentümer</h5>
                <div class="table-responsive">
                    <table class="table table-sm align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Name</th>
                                <th class="text-end">Anteil</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ownership in property_obj.ownerships.all %}
                            <tr>
                                <td>{{ ownership.owner.name }}</td>
                                <td class="text-end">{{ ownership.share_percent|floatformat:2 }} %</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="2" class="text-center py-3 text-muted">Keine Eigentümer hinterlegt.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="card border-0 shadow-sm mt-4">
            <div class="card-body p-4">
                <h5 class="mb-3">Einheiten</h5>
                <div class="table-responsive">
                    <table class="table table-sm align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Einheit</th>
                                <th>Tür</th>
                                <th>Typ</th>
                                <th class="text-end">Nutzfläche</th>
                                <th class="text-end">BK-Anteil</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for unit in units %}
                            <tr>
                                <td class="fw-semibold">{{ unit.name }}</td>
                                <td>{{ unit.door_number }}</td>
                                <td>{{ unit.get_unit_type_display }}</td>
                                <td class="text-end">{{ unit.usable_area|default:"—" }}</td>
                                <td class="text-end">{{ unit.operating_cost_share|default:"—" }}</td>
                                <td>
                                    {% if unit.active_lease_count %}
                                        <span class="badge text-bg-success">Vermietet</span>
                                    {% else %}
                                        <span class="badge text-bg-secondary">Frei</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center py-3 text-muted">Keine Einheiten vorhanden.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 col-xl-4">
        {% include "webapp/partials/_attachments_panel.html" with attachments_panel=attachments_panel attachments_panel_inline=True %}
    </div>
</div>
{% endblock %}
